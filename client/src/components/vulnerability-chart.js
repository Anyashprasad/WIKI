import { useRef } from 'react';
import { Chart as ChartJS, CategoryScale, LinearScale, BarElement, ArcElement, Title, Tooltip, Legend, } from 'chart.js';
import { Chart } from 'react-chartjs-2';
ChartJS.register(CategoryScale, LinearScale, BarElement, ArcElement, Title, Tooltip, Legend);
const severityColors = {
    Critical: '#FF4444',
    High: '#FF8800',
    Medium: '#FFAA00',
    Low: '#00FF88'
};
const categoryColors = {
    'SQL Injection': '#FF4444',
    'XSS': '#FF8800',
    'CSRF': '#FFAA00',
    'API Issues': '#00FF88',
    'Load Testing': '#0088FF'
};
export default function VulnerabilityChart({ vulnerabilities, type }) {
    const chartRef = useRef(null);
    const data = type === 'category'
        ? vulnerabilities.reduce((acc, vuln) => {
            acc[vuln.category] = (acc[vuln.category] || 0) + 1;
            return acc;
        }, {})
        : vulnerabilities.reduce((acc, vuln) => {
            acc[vuln.severity] = (acc[vuln.severity] || 0) + 1;
            return acc;
        }, {});
    const colors = type === 'category' ? categoryColors : severityColors;
    const chartData = {
        labels: Object.keys(data),
        datasets: [{
                data: Object.values(data),
                backgroundColor: Object.keys(data).map(key => colors[key]),
                borderColor: '#1A1A1A',
                borderWidth: 2,
                hoverBorderWidth: 3,
                hoverBorderColor: '#00FF88',
            }]
    };
    const options = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                position: 'bottom',
                labels: {
                    color: '#FFFFFF',
                    padding: 20,
                    font: {
                        size: 12
                    }
                }
            },
            tooltip: {
                backgroundColor: '#1A1A1A',
                titleColor: '#00FF88',
                bodyColor: '#FFFFFF',
                borderColor: '#00FF88',
                borderWidth: 1,
            }
        },
        onHover: (event, elements) => {
            const canvas = event.native?.target;
            if (canvas) {
                canvas.style.cursor = elements.length > 0 ? 'pointer' : 'default';
            }
        },
        scales: type === 'severity' ? {
            y: {
                beginAtZero: true,
                ticks: {
                    color: '#FFFFFF',
                    stepSize: 1
                },
                grid: {
                    color: '#333333'
                }
            },
            x: {
                ticks: {
                    color: '#FFFFFF'
                },
                grid: {
                    color: '#333333'
                }
            }
        } : undefined
    };
    return (<div className="relative h-64" data-testid={`chart-${type}`}>
      <Chart ref={chartRef} type={type === 'category' ? 'doughnut' : 'bar'} data={chartData} options={options}/>
    </div>);
}
